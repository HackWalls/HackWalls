{"version":3,"sources":["../yjs/node_modules/browser-pack/_prelude.js","src/Memory.js","y-memory.js","src/RedBlackTree.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","extend","Y","Transaction","_Y$Transaction","store","this","_this","getPrototypeOf","ss","os","ds","Store","utils","RBTree","BufferedStore","createSmallLookupBuffer","Database","_Y$AbstractDatabase","y","opts","_this2","_createClass","key","requestTransaction","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","console","log","connector","userId","t0","delegateYield","getStateSet","t2","t1","logTable","gc1","gc2","warn","JSON","stringify","listenersById","listenersByIdExecuteNow","transactionInProgress","stop","makeGen","gen","res","done","getNextRequest","destroy","_context2","_get","AbstractDatabase","defineProperties","target","props","descriptor","defineProperty","protoProps","staticProps","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getter","./RedBlackTree.js",2,"_typeof","Symbol","iterator","obj","N","val","color","_left","_right","_parent","id","tree","newParent","right","newRight","left","root","p","newLeft","set","findNext","findWithLowerBound","abrupt","findPrev","findWithUpperBound","from","smaller","to","_context3","findNodeWithLowerBound","_context4","findNodeWithUpperBound","iterate","_context5","compareIds","filter","_context7","o_","_context6","push","table","find","_context8","findNode","Array","_delete","d","isFakeChild","child","_context9","blacken","isBlack","isRed","_fixDelete","node","sibling","redden","rotateLeft","rotateRight","put","v","_context10","_fixInsert","uncle","getUncle","grandparent","flush","_context11"],"mappings":"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","file":"y-memory.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\r\n'use strict'\r\n\r\nfunction extend (Y) {\r\n  require('./RedBlackTree.js')(Y)\r\n  class Transaction extends Y.Transaction {\r\n    constructor (store) {\r\n      super(store)\r\n      this.store = store\r\n      this.ss = store.ss\r\n      this.os = store.os\r\n      this.ds = store.ds\r\n    }\r\n  }\r\n  var Store = Y.utils.RBTree\r\n  var BufferedStore = Y.utils.createSmallLookupBuffer(Store)\r\n\r\n  class Database extends Y.AbstractDatabase {\r\n    constructor (y, opts) {\r\n      super(y, opts)\r\n      this.os = new BufferedStore()\r\n      this.ds = new Store()\r\n      this.ss = new BufferedStore()\r\n    }\r\n    logTable () {\r\n      var self = this\r\n      self.requestTransaction(function * () {\r\n        console.log('User: ', this.store.y.connector.userId, \"==============================\") // eslint-disable-line\r\n        console.log(\"State Set (SS):\", yield* this.getStateSet()) // eslint-disable-line\r\n        console.log(\"Operation Store (OS):\") // eslint-disable-line\r\n        yield* this.os.logTable() // eslint-disable-line\r\n        console.log(\"Deletion Store (DS):\") //eslint-disable-line\r\n        yield* this.ds.logTable() // eslint-disable-line\r\n        if (this.store.gc1.length > 0 || this.store.gc2.length > 0) {\r\n          console.warn('GC1|2 not empty!', this.store.gc1, this.store.gc2)\r\n        }\r\n        if (JSON.stringify(this.store.listenersById) !== '{}') {\r\n          console.warn('listenersById not empty!')\r\n        }\r\n        if (JSON.stringify(this.store.listenersByIdExecuteNow) !== '[]') {\r\n          console.warn('listenersByIdExecuteNow not empty!')\r\n        }\r\n        if (this.store.transactionInProgress) {\r\n          console.warn('Transaction still in progress!')\r\n        }\r\n      }, true)\r\n    }\r\n    transact (makeGen) {\r\n      var t = new Transaction(this)\r\n      while (makeGen !== null) {\r\n        var gen = makeGen.call(t)\r\n        var res = gen.next()\r\n        while (!res.done) {\r\n          res = gen.next(res.value)\r\n        }\r\n        makeGen = this.getNextRequest()\r\n      }\r\n    }\r\n    * destroy () {\r\n      super.destroy()\r\n      delete this.os\r\n      delete this.ss\r\n      delete this.ds\r\n    }\r\n  }\r\n  Y.extend('memory', Database)\r\n}\r\n\r\nmodule.exports = extend\r\nif (typeof Y !== 'undefined') {\r\n  extend(Y)\r\n}\r\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/* global Y */\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction extend(Y) {\n  require('./RedBlackTree.js')(Y);\n\n  var Transaction = function (_Y$Transaction) {\n    _inherits(Transaction, _Y$Transaction);\n\n    function Transaction(store) {\n      _classCallCheck(this, Transaction);\n\n      var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Transaction).call(this, store));\n\n      _this.store = store;\n      _this.ss = store.ss;\n      _this.os = store.os;\n      _this.ds = store.ds;\n      return _this;\n    }\n\n    return Transaction;\n  }(Y.Transaction);\n\n  var Store = Y.utils.RBTree;\n  var BufferedStore = Y.utils.createSmallLookupBuffer(Store);\n\n  var Database = function (_Y$AbstractDatabase) {\n    _inherits(Database, _Y$AbstractDatabase);\n\n    function Database(y, opts) {\n      _classCallCheck(this, Database);\n\n      var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(Database).call(this, y, opts));\n\n      _this2.os = new BufferedStore();\n      _this2.ds = new Store();\n      _this2.ss = new BufferedStore();\n      return _this2;\n    }\n\n    _createClass(Database, [{\n      key: 'logTable',\n      value: function logTable() {\n        var self = this;\n        self.requestTransaction(regeneratorRuntime.mark(function _callee() {\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  console.log('User: ', this.store.y.connector.userId, \"==============================\"); // eslint-disable-line\n                  _context.t0 = console;\n                  return _context.delegateYield(this.getStateSet(), 't1', 3);\n\n                case 3:\n                  _context.t2 = _context.t1;\n\n                  _context.t0.log.call(_context.t0, \"State Set (SS):\", _context.t2);\n\n                  // eslint-disable-line\n                  console.log(\"Operation Store (OS):\"); // eslint-disable-line\n                  return _context.delegateYield(this.os.logTable(), 't3', 7);\n\n                case 7:\n                  // eslint-disable-line\n                  console.log(\"Deletion Store (DS):\"); //eslint-disable-line\n                  return _context.delegateYield(this.ds.logTable(), 't4', 9);\n\n                case 9:\n                  // eslint-disable-line\n                  if (this.store.gc1.length > 0 || this.store.gc2.length > 0) {\n                    console.warn('GC1|2 not empty!', this.store.gc1, this.store.gc2);\n                  }\n                  if (JSON.stringify(this.store.listenersById) !== '{}') {\n                    console.warn('listenersById not empty!');\n                  }\n                  if (JSON.stringify(this.store.listenersByIdExecuteNow) !== '[]') {\n                    console.warn('listenersByIdExecuteNow not empty!');\n                  }\n                  if (this.store.transactionInProgress) {\n                    console.warn('Transaction still in progress!');\n                  }\n\n                case 13:\n                case 'end':\n                  return _context.stop();\n              }\n            }\n          }, _callee, this);\n        }), true);\n      }\n    }, {\n      key: 'transact',\n      value: function transact(makeGen) {\n        var t = new Transaction(this);\n        while (makeGen !== null) {\n          var gen = makeGen.call(t);\n          var res = gen.next();\n          while (!res.done) {\n            res = gen.next(res.value);\n          }\n          makeGen = this.getNextRequest();\n        }\n      }\n    }, {\n      key: 'destroy',\n      value: regeneratorRuntime.mark(function destroy() {\n        return regeneratorRuntime.wrap(function destroy$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _get(Object.getPrototypeOf(Database.prototype), 'destroy', this).call(this);\n                delete this.os;\n                delete this.ss;\n                delete this.ds;\n\n              case 4:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, destroy, this);\n      })\n    }]);\n\n    return Database;\n  }(Y.AbstractDatabase);\n\n  Y.extend('memory', Database);\n}\n\nmodule.exports = extend;\nif (typeof Y !== 'undefined') {\n  extend(Y);\n}\n\n},{\"./RedBlackTree.js\":2}],2:[function(require,module,exports){\n'use strict';\n\n/*\r\n  This file contains a not so fancy implemantion of a Red Black Tree.\r\n*/\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function (Y) {\n  var N = function () {\n    // A created node is always red!\n\n    function N(val) {\n      _classCallCheck(this, N);\n\n      this.val = val;\n      this.color = true;\n      this._left = null;\n      this._right = null;\n      this._parent = null;\n      if (val.id === null) {\n        throw new Error('You must define id!');\n      }\n    }\n\n    _createClass(N, [{\n      key: 'isRed',\n      value: function isRed() {\n        return this.color;\n      }\n    }, {\n      key: 'isBlack',\n      value: function isBlack() {\n        return !this.color;\n      }\n    }, {\n      key: 'redden',\n      value: function redden() {\n        this.color = true;return this;\n      }\n    }, {\n      key: 'blacken',\n      value: function blacken() {\n        this.color = false;return this;\n      }\n    }, {\n      key: 'rotateLeft',\n      value: function rotateLeft(tree) {\n        var parent = this.parent;\n        var newParent = this.right;\n        var newRight = this.right.left;\n        newParent.left = this;\n        this.right = newRight;\n        if (parent === null) {\n          tree.root = newParent;\n          newParent._parent = null;\n        } else if (parent.left === this) {\n          parent.left = newParent;\n        } else if (parent.right === this) {\n          parent.right = newParent;\n        } else {\n          throw new Error('The elements are wrongly connected!');\n        }\n      }\n    }, {\n      key: 'next',\n      value: function next() {\n        if (this.right !== null) {\n          // search the most left node in the right tree\n          var o = this.right;\n          while (o.left !== null) {\n            o = o.left;\n          }\n          return o;\n        } else {\n          var p = this;\n          while (p.parent !== null && p !== p.parent.left) {\n            p = p.parent;\n          }\n          return p.parent;\n        }\n      }\n    }, {\n      key: 'prev',\n      value: function prev() {\n        if (this.left !== null) {\n          // search the most right node in the left tree\n          var o = this.left;\n          while (o.right !== null) {\n            o = o.right;\n          }\n          return o;\n        } else {\n          var p = this;\n          while (p.parent !== null && p !== p.parent.right) {\n            p = p.parent;\n          }\n          return p.parent;\n        }\n      }\n    }, {\n      key: 'rotateRight',\n      value: function rotateRight(tree) {\n        var parent = this.parent;\n        var newParent = this.left;\n        var newLeft = this.left.right;\n        newParent.right = this;\n        this.left = newLeft;\n        if (parent === null) {\n          tree.root = newParent;\n          newParent._parent = null;\n        } else if (parent.left === this) {\n          parent.left = newParent;\n        } else if (parent.right === this) {\n          parent.right = newParent;\n        } else {\n          throw new Error('The elements are wrongly connected!');\n        }\n      }\n    }, {\n      key: 'getUncle',\n      value: function getUncle() {\n        // we can assume that grandparent exists when this is called!\n        if (this.parent === this.parent.parent.left) {\n          return this.parent.parent.right;\n        } else {\n          return this.parent.parent.left;\n        }\n      }\n    }, {\n      key: 'grandparent',\n      get: function get() {\n        return this.parent.parent;\n      }\n    }, {\n      key: 'parent',\n      get: function get() {\n        return this._parent;\n      }\n    }, {\n      key: 'sibling',\n      get: function get() {\n        return this === this.parent.left ? this.parent.right : this.parent.left;\n      }\n    }, {\n      key: 'left',\n      get: function get() {\n        return this._left;\n      },\n      set: function set(n) {\n        if (n !== null) {\n          n._parent = this;\n        }\n        this._left = n;\n      }\n    }, {\n      key: 'right',\n      get: function get() {\n        return this._right;\n      },\n      set: function set(n) {\n        if (n !== null) {\n          n._parent = this;\n        }\n        this._right = n;\n      }\n    }]);\n\n    return N;\n  }();\n\n  var RBTree = function () {\n    function RBTree() {\n      _classCallCheck(this, RBTree);\n\n      this.root = null;\n      this.length = 0;\n    }\n\n    _createClass(RBTree, [{\n      key: 'findNext',\n      value: regeneratorRuntime.mark(function findNext(id) {\n        return regeneratorRuntime.wrap(function findNext$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.delegateYield(this.findWithLowerBound([id[0], id[1] + 1]), 't0', 1);\n\n              case 1:\n                return _context.abrupt('return', _context.t0);\n\n              case 2:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, findNext, this);\n      })\n    }, {\n      key: 'findPrev',\n      value: regeneratorRuntime.mark(function findPrev(id) {\n        return regeneratorRuntime.wrap(function findPrev$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.delegateYield(this.findWithUpperBound([id[0], id[1] - 1]), 't0', 1);\n\n              case 1:\n                return _context2.abrupt('return', _context2.t0);\n\n              case 2:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, findPrev, this);\n      })\n    }, {\n      key: 'findNodeWithLowerBound',\n      value: function findNodeWithLowerBound(from) {\n        if (from === void 0) {\n          throw new Error('You must define from!');\n        }\n        var o = this.root;\n        if (o === null) {\n          return null;\n        } else {\n          while (true) {\n            if ((from === null || Y.utils.smaller(from, o.val.id)) && o.left !== null) {\n              // o is included in the bound\n              // try to find an element that is closer to the bound\n              o = o.left;\n            } else if (from !== null && Y.utils.smaller(o.val.id, from)) {\n              // o is not within the bound, maybe one of the right elements is..\n              if (o.right !== null) {\n                o = o.right;\n              } else {\n                // there is no right element. Search for the next bigger element,\n                // this should be within the bounds\n                return o.next();\n              }\n            } else {\n              return o;\n            }\n          }\n        }\n      }\n    }, {\n      key: 'findNodeWithUpperBound',\n      value: function findNodeWithUpperBound(to) {\n        if (to === void 0) {\n          throw new Error('You must define from!');\n        }\n        var o = this.root;\n        if (o === null) {\n          return null;\n        } else {\n          while (true) {\n            if ((to === null || Y.utils.smaller(o.val.id, to)) && o.right !== null) {\n              // o is included in the bound\n              // try to find an element that is closer to the bound\n              o = o.right;\n            } else if (to !== null && Y.utils.smaller(to, o.val.id)) {\n              // o is not within the bound, maybe one of the left elements is..\n              if (o.left !== null) {\n                o = o.left;\n              } else {\n                // there is no left element. Search for the prev smaller element,\n                // this should be within the bounds\n                return o.prev();\n              }\n            } else {\n              return o;\n            }\n          }\n        }\n      }\n    }, {\n      key: 'findWithLowerBound',\n      value: regeneratorRuntime.mark(function findWithLowerBound(from) {\n        var n;\n        return regeneratorRuntime.wrap(function findWithLowerBound$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                n = this.findNodeWithLowerBound(from);\n                return _context3.abrupt('return', n == null ? null : n.val);\n\n              case 2:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, findWithLowerBound, this);\n      })\n    }, {\n      key: 'findWithUpperBound',\n      value: regeneratorRuntime.mark(function findWithUpperBound(to) {\n        var n;\n        return regeneratorRuntime.wrap(function findWithUpperBound$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                n = this.findNodeWithUpperBound(to);\n                return _context4.abrupt('return', n == null ? null : n.val);\n\n              case 2:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, findWithUpperBound, this);\n      })\n    }, {\n      key: 'iterate',\n      value: regeneratorRuntime.mark(function iterate(t, from, to, f) {\n        var o;\n        return regeneratorRuntime.wrap(function iterate$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                o = this.findNodeWithLowerBound(from);\n\n              case 1:\n                if (!(o !== null && (to === null || Y.utils.smaller(o.val.id, to) || Y.utils.compareIds(o.val.id, to)))) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                return _context5.delegateYield(f.call(t, o.val), 't0', 3);\n\n              case 3:\n                o = o.next();\n                _context5.next = 1;\n                break;\n\n              case 6:\n                return _context5.abrupt('return', true);\n\n              case 7:\n              case 'end':\n                return _context5.stop();\n            }\n          }\n        }, iterate, this);\n      })\n    }, {\n      key: 'logTable',\n      value: regeneratorRuntime.mark(function logTable(from, to, filter) {\n        var os;\n        return regeneratorRuntime.wrap(function logTable$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (filter == null) {\n                  filter = function filter() {\n                    return true;\n                  };\n                }\n                if (from == null) {\n                  from = null;\n                }\n                if (to == null) {\n                  to = null;\n                }\n                os = [];\n                return _context7.delegateYield(this.iterate(this, from, to, regeneratorRuntime.mark(function _callee(o) {\n                  var o_, key;\n                  return regeneratorRuntime.wrap(function _callee$(_context6) {\n                    while (1) {\n                      switch (_context6.prev = _context6.next) {\n                        case 0:\n                          if (filter(o)) {\n                            o_ = {};\n\n                            for (key in o) {\n                              if (_typeof(o[key]) === 'object') {\n                                o_[key] = JSON.stringify(o[key]);\n                              } else {\n                                o_[key] = o[key];\n                              }\n                            }\n                            os.push(o_);\n                          }\n\n                        case 1:\n                        case 'end':\n                          return _context6.stop();\n                      }\n                    }\n                  }, _callee, this);\n                })), 't0', 5);\n\n              case 5:\n                if (console.table != null) {\n                  console.table(os);\n                }\n\n              case 6:\n              case 'end':\n                return _context7.stop();\n            }\n          }\n        }, logTable, this);\n      })\n    }, {\n      key: 'find',\n      value: regeneratorRuntime.mark(function find(id) {\n        var n;\n        return regeneratorRuntime.wrap(function find$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                return _context8.abrupt('return', (n = this.findNode(id)) ? n.val : null);\n\n              case 1:\n              case 'end':\n                return _context8.stop();\n            }\n          }\n        }, find, this);\n      })\n    }, {\n      key: 'findNode',\n      value: function findNode(id) {\n        if (id == null || id.constructor !== Array) {\n          throw new Error('Expect id to be an array!');\n        }\n        var o = this.root;\n        if (o === null) {\n          return false;\n        } else {\n          while (true) {\n            if (o === null) {\n              return false;\n            }\n            if (Y.utils.smaller(id, o.val.id)) {\n              o = o.left;\n            } else if (Y.utils.smaller(o.val.id, id)) {\n              o = o.right;\n            } else {\n              return o;\n            }\n          }\n        }\n      }\n    }, {\n      key: 'delete',\n      value: regeneratorRuntime.mark(function _delete(id) {\n        var d, o, isFakeChild, child;\n        return regeneratorRuntime.wrap(function _delete$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                if (!(id == null || id.constructor !== Array)) {\n                  _context9.next = 2;\n                  break;\n                }\n\n                throw new Error('id is expected to be an Array!');\n\n              case 2:\n                d = this.findNode(id);\n\n                if (!(d == null)) {\n                  _context9.next = 5;\n                  break;\n                }\n\n                return _context9.abrupt('return');\n\n              case 5:\n                this.length--;\n                if (d.left !== null && d.right !== null) {\n                  // switch d with the greates element in the left subtree.\n                  // o should have at most one child.\n                  o = d.left;\n                  // find\n\n                  while (o.right !== null) {\n                    o = o.right;\n                  }\n                  // switch\n                  d.val = o.val;\n                  d = o;\n                }\n                // d has at most one child\n                // let n be the node that replaces d\n                child = d.left || d.right;\n\n                if (child === null) {\n                  isFakeChild = true;\n                  child = new N({ id: 0 });\n                  child.blacken();\n                  d.right = child;\n                } else {\n                  isFakeChild = false;\n                }\n\n                if (!(d.parent === null)) {\n                  _context9.next = 14;\n                  break;\n                }\n\n                if (!isFakeChild) {\n                  this.root = child;\n                  child.blacken();\n                  child._parent = null;\n                } else {\n                  this.root = null;\n                }\n                return _context9.abrupt('return');\n\n              case 14:\n                if (!(d.parent.left === d)) {\n                  _context9.next = 18;\n                  break;\n                }\n\n                d.parent.left = child;\n                _context9.next = 23;\n                break;\n\n              case 18:\n                if (!(d.parent.right === d)) {\n                  _context9.next = 22;\n                  break;\n                }\n\n                d.parent.right = child;\n                _context9.next = 23;\n                break;\n\n              case 22:\n                throw new Error('Impossible!');\n\n              case 23:\n                if (d.isBlack()) {\n                  if (child.isRed()) {\n                    child.blacken();\n                  } else {\n                    this._fixDelete(child);\n                  }\n                }\n                this.root.blacken();\n\n                if (!isFakeChild) {\n                  _context9.next = 35;\n                  break;\n                }\n\n                if (!(child.parent.left === child)) {\n                  _context9.next = 30;\n                  break;\n                }\n\n                child.parent.left = null;\n                _context9.next = 35;\n                break;\n\n              case 30:\n                if (!(child.parent.right === child)) {\n                  _context9.next = 34;\n                  break;\n                }\n\n                child.parent.right = null;\n                _context9.next = 35;\n                break;\n\n              case 34:\n                throw new Error('Impossible #3');\n\n              case 35:\n              case 'end':\n                return _context9.stop();\n            }\n          }\n        }, _delete, this);\n      })\n    }, {\n      key: '_fixDelete',\n      value: function _fixDelete(n) {\n        function isBlack(node) {\n          return node !== null ? node.isBlack() : true;\n        }\n        function isRed(node) {\n          return node !== null ? node.isRed() : false;\n        }\n        if (n.parent === null) {\n          // this can only be called after the first iteration of fixDelete.\n          return;\n        }\n        // d was already replaced by the child\n        // d is not the root\n        // d and child are black\n        var sibling = n.sibling;\n        if (isRed(sibling)) {\n          // make sibling the grandfather\n          n.parent.redden();\n          sibling.blacken();\n          if (n === n.parent.left) {\n            n.parent.rotateLeft(this);\n          } else if (n === n.parent.right) {\n            n.parent.rotateRight(this);\n          } else {\n            throw new Error('Impossible #2');\n          }\n          sibling = n.sibling;\n        }\n        // parent, sibling, and children of n are black\n        if (n.parent.isBlack() && sibling.isBlack() && isBlack(sibling.left) && isBlack(sibling.right)) {\n          sibling.redden();\n          this._fixDelete(n.parent);\n        } else if (n.parent.isRed() && sibling.isBlack() && isBlack(sibling.left) && isBlack(sibling.right)) {\n          sibling.redden();\n          n.parent.blacken();\n        } else {\n          if (n === n.parent.left && sibling.isBlack() && isRed(sibling.left) && isBlack(sibling.right)) {\n            sibling.redden();\n            sibling.left.blacken();\n            sibling.rotateRight(this);\n            sibling = n.sibling;\n          } else if (n === n.parent.right && sibling.isBlack() && isRed(sibling.right) && isBlack(sibling.left)) {\n            sibling.redden();\n            sibling.right.blacken();\n            sibling.rotateLeft(this);\n            sibling = n.sibling;\n          }\n          sibling.color = n.parent.color;\n          n.parent.blacken();\n          if (n === n.parent.left) {\n            sibling.right.blacken();\n            n.parent.rotateLeft(this);\n          } else {\n            sibling.left.blacken();\n            n.parent.rotateRight(this);\n          }\n        }\n      }\n    }, {\n      key: 'put',\n      value: regeneratorRuntime.mark(function put(v) {\n        var node, p;\n        return regeneratorRuntime.wrap(function put$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                if (!(v == null || v.id == null || v.id.constructor !== Array)) {\n                  _context10.next = 2;\n                  break;\n                }\n\n                throw new Error('v is expected to have an id property which is an Array!');\n\n              case 2:\n                node = new N(v);\n\n                if (!(this.root !== null)) {\n                  _context10.next = 31;\n                  break;\n                }\n\n                p = this.root; // p abbrev. parent\n\n              case 5:\n                if (!true) {\n                  _context10.next = 28;\n                  break;\n                }\n\n                if (!Y.utils.smaller(node.val.id, p.val.id)) {\n                  _context10.next = 15;\n                  break;\n                }\n\n                if (!(p.left === null)) {\n                  _context10.next = 12;\n                  break;\n                }\n\n                p.left = node;\n                return _context10.abrupt('break', 28);\n\n              case 12:\n                p = p.left;\n\n              case 13:\n                _context10.next = 26;\n                break;\n\n              case 15:\n                if (!Y.utils.smaller(p.val.id, node.val.id)) {\n                  _context10.next = 24;\n                  break;\n                }\n\n                if (!(p.right === null)) {\n                  _context10.next = 21;\n                  break;\n                }\n\n                p.right = node;\n                return _context10.abrupt('break', 28);\n\n              case 21:\n                p = p.right;\n\n              case 22:\n                _context10.next = 26;\n                break;\n\n              case 24:\n                p.val = node.val;\n                return _context10.abrupt('return', p);\n\n              case 26:\n                _context10.next = 5;\n                break;\n\n              case 28:\n                this._fixInsert(node);\n                _context10.next = 32;\n                break;\n\n              case 31:\n                this.root = node;\n\n              case 32:\n                this.length++;\n                this.root.blacken();\n                return _context10.abrupt('return', node);\n\n              case 35:\n              case 'end':\n                return _context10.stop();\n            }\n          }\n        }, put, this);\n      })\n    }, {\n      key: '_fixInsert',\n      value: function _fixInsert(n) {\n        if (n.parent === null) {\n          n.blacken();\n          return;\n        } else if (n.parent.isBlack()) {\n          return;\n        }\n        var uncle = n.getUncle();\n        if (uncle !== null && uncle.isRed()) {\n          // Note: parent: red, uncle: red\n          n.parent.blacken();\n          uncle.blacken();\n          n.grandparent.redden();\n          this._fixInsert(n.grandparent);\n        } else {\n          // Note: parent: red, uncle: black or null\n          // Now we transform the tree in such a way that\n          // either of these holds:\n          //   1) grandparent.left.isRed\n          //     and grandparent.left.left.isRed\n          //   2) grandparent.right.isRed\n          //     and grandparent.right.right.isRed\n          if (n === n.parent.right && n.parent === n.grandparent.left) {\n            n.parent.rotateLeft(this);\n            // Since we rotated and want to use the previous\n            // cases, we need to set n in such a way that\n            // n.parent.isRed again\n            n = n.left;\n          } else if (n === n.parent.left && n.parent === n.grandparent.right) {\n            n.parent.rotateRight(this);\n            // see above\n            n = n.right;\n          }\n          // Case 1) or 2) hold from here on.\n          // Now traverse grandparent, make parent a black node\n          // on the highest level which holds two red nodes.\n          n.parent.blacken();\n          n.grandparent.redden();\n          if (n === n.parent.left) {\n            // Case 1\n            n.grandparent.rotateRight(this);\n          } else {\n            // Case 2\n            n.grandparent.rotateLeft(this);\n          }\n        }\n      }\n    }, {\n      key: 'flush',\n      value: regeneratorRuntime.mark(function flush() {\n        return regeneratorRuntime.wrap(function flush$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n              case 'end':\n                return _context11.stop();\n            }\n          }\n        }, flush, this);\n      })\n    }]);\n\n    return RBTree;\n  }();\n\n  Y.utils.RBTree = RBTree;\n};\n\n},{}]},{},[1])\n\n","'use strict'\r\n\r\n/*\r\n  This file contains a not so fancy implemantion of a Red Black Tree.\r\n*/\r\nmodule.exports = function (Y) {\r\n  class N {\r\n    // A created node is always red!\r\n    constructor (val) {\r\n      this.val = val\r\n      this.color = true\r\n      this._left = null\r\n      this._right = null\r\n      this._parent = null\r\n      if (val.id === null) {\r\n        throw new Error('You must define id!')\r\n      }\r\n    }\r\n    isRed () { return this.color }\r\n    isBlack () { return !this.color }\r\n    redden () { this.color = true; return this }\r\n    blacken () { this.color = false; return this }\r\n    get grandparent () {\r\n      return this.parent.parent\r\n    }\r\n    get parent () {\r\n      return this._parent\r\n    }\r\n    get sibling () {\r\n      return (this === this.parent.left)\r\n        ? this.parent.right : this.parent.left\r\n    }\r\n    get left () {\r\n      return this._left\r\n    }\r\n    get right () {\r\n      return this._right\r\n    }\r\n    set left (n) {\r\n      if (n !== null) {\r\n        n._parent = this\r\n      }\r\n      this._left = n\r\n    }\r\n    set right (n) {\r\n      if (n !== null) {\r\n        n._parent = this\r\n      }\r\n      this._right = n\r\n    }\r\n    rotateLeft (tree) {\r\n      var parent = this.parent\r\n      var newParent = this.right\r\n      var newRight = this.right.left\r\n      newParent.left = this\r\n      this.right = newRight\r\n      if (parent === null) {\r\n        tree.root = newParent\r\n        newParent._parent = null\r\n      } else if (parent.left === this) {\r\n        parent.left = newParent\r\n      } else if (parent.right === this) {\r\n        parent.right = newParent\r\n      } else {\r\n        throw new Error('The elements are wrongly connected!')\r\n      }\r\n    }\r\n    next () {\r\n      if (this.right !== null) {\r\n        // search the most left node in the right tree\r\n        var o = this.right\r\n        while (o.left !== null) {\r\n          o = o.left\r\n        }\r\n        return o\r\n      } else {\r\n        var p = this\r\n        while (p.parent !== null && p !== p.parent.left) {\r\n          p = p.parent\r\n        }\r\n        return p.parent\r\n      }\r\n    }\r\n    prev () {\r\n      if (this.left !== null) {\r\n        // search the most right node in the left tree\r\n        var o = this.left\r\n        while (o.right !== null) {\r\n          o = o.right\r\n        }\r\n        return o\r\n      } else {\r\n        var p = this\r\n        while (p.parent !== null && p !== p.parent.right) {\r\n          p = p.parent\r\n        }\r\n        return p.parent\r\n      }\r\n    }\r\n    rotateRight (tree) {\r\n      var parent = this.parent\r\n      var newParent = this.left\r\n      var newLeft = this.left.right\r\n      newParent.right = this\r\n      this.left = newLeft\r\n      if (parent === null) {\r\n        tree.root = newParent\r\n        newParent._parent = null\r\n      } else if (parent.left === this) {\r\n        parent.left = newParent\r\n      } else if (parent.right === this) {\r\n        parent.right = newParent\r\n      } else {\r\n        throw new Error('The elements are wrongly connected!')\r\n      }\r\n    }\r\n    getUncle () {\r\n      // we can assume that grandparent exists when this is called!\r\n      if (this.parent === this.parent.parent.left) {\r\n        return this.parent.parent.right\r\n      } else {\r\n        return this.parent.parent.left\r\n      }\r\n    }\r\n  }\r\n\r\n  class RBTree {\r\n    constructor () {\r\n      this.root = null\r\n      this.length = 0\r\n    }\r\n    * findNext (id) {\r\n      return yield* this.findWithLowerBound([id[0], id[1] + 1])\r\n    }\r\n    * findPrev (id) {\r\n      return yield* this.findWithUpperBound([id[0], id[1] - 1])\r\n    }\r\n    findNodeWithLowerBound (from) {\r\n      if (from === void 0) {\r\n        throw new Error('You must define from!')\r\n      }\r\n      var o = this.root\r\n      if (o === null) {\r\n        return null\r\n      } else {\r\n        while (true) {\r\n          if ((from === null || Y.utils.smaller(from, o.val.id)) && o.left !== null) {\r\n            // o is included in the bound\r\n            // try to find an element that is closer to the bound\r\n            o = o.left\r\n          } else if (from !== null && Y.utils.smaller(o.val.id, from)) {\r\n            // o is not within the bound, maybe one of the right elements is..\r\n            if (o.right !== null) {\r\n              o = o.right\r\n            } else {\r\n              // there is no right element. Search for the next bigger element,\r\n              // this should be within the bounds\r\n              return o.next()\r\n            }\r\n          } else {\r\n            return o\r\n          }\r\n        }\r\n      }\r\n    }\r\n    findNodeWithUpperBound (to) {\r\n      if (to === void 0) {\r\n        throw new Error('You must define from!')\r\n      }\r\n      var o = this.root\r\n      if (o === null) {\r\n        return null\r\n      } else {\r\n        while (true) {\r\n          if ((to === null || Y.utils.smaller(o.val.id, to)) && o.right !== null) {\r\n            // o is included in the bound\r\n            // try to find an element that is closer to the bound\r\n            o = o.right\r\n          } else if (to !== null && Y.utils.smaller(to, o.val.id)) {\r\n            // o is not within the bound, maybe one of the left elements is..\r\n            if (o.left !== null) {\r\n              o = o.left\r\n            } else {\r\n              // there is no left element. Search for the prev smaller element,\r\n              // this should be within the bounds\r\n              return o.prev()\r\n            }\r\n          } else {\r\n            return o\r\n          }\r\n        }\r\n      }\r\n    }\r\n    * findWithLowerBound (from) {\r\n      var n = this.findNodeWithLowerBound(from)\r\n      return n == null ? null : n.val\r\n    }\r\n    * findWithUpperBound (to) {\r\n      var n = this.findNodeWithUpperBound(to)\r\n      return n == null ? null : n.val\r\n    }\r\n    * iterate (t, from, to, f) {\r\n      var o = this.findNodeWithLowerBound(from)\r\n      while (o !== null && (to === null || Y.utils.smaller(o.val.id, to) || Y.utils.compareIds(o.val.id, to))) {\r\n        yield* f.call(t, o.val)\r\n        o = o.next()\r\n      }\r\n      return true\r\n    }\r\n    * logTable (from, to, filter) {\r\n      if (filter == null) {\r\n        filter = function () {\r\n          return true\r\n        }\r\n      }\r\n      if (from == null) { from = null }\r\n      if (to == null) { to = null }\r\n      var os = []\r\n      yield* this.iterate(this, from, to, function * (o) {\r\n        if (filter(o)) {\r\n          var o_ = {}\r\n          for (var key in o) {\r\n            if (typeof o[key] === 'object') {\r\n              o_[key] = JSON.stringify(o[key])\r\n            } else {\r\n              o_[key] = o[key]\r\n            }\r\n          }\r\n          os.push(o_)\r\n        }\r\n      })\r\n      if (console.table != null) {\r\n        console.table(os)\r\n      }\r\n    }\r\n    * find (id) {\r\n      var n\r\n      return (n = this.findNode(id)) ? n.val : null\r\n    }\r\n    findNode (id) {\r\n      if (id == null || id.constructor !== Array) {\r\n        throw new Error('Expect id to be an array!')\r\n      }\r\n      var o = this.root\r\n      if (o === null) {\r\n        return false\r\n      } else {\r\n        while (true) {\r\n          if (o === null) {\r\n            return false\r\n          }\r\n          if (Y.utils.smaller(id, o.val.id)) {\r\n            o = o.left\r\n          } else if (Y.utils.smaller(o.val.id, id)) {\r\n            o = o.right\r\n          } else {\r\n            return o\r\n          }\r\n        }\r\n      }\r\n    }\r\n    * delete (id) {\r\n      if (id == null || id.constructor !== Array) {\r\n        throw new Error('id is expected to be an Array!')\r\n      }\r\n      var d = this.findNode(id)\r\n      if (d == null) {\r\n        // throw new Error('Element does not exist!')\r\n        return\r\n      }\r\n      this.length--\r\n      if (d.left !== null && d.right !== null) {\r\n        // switch d with the greates element in the left subtree.\r\n        // o should have at most one child.\r\n        var o = d.left\r\n        // find\r\n        while (o.right !== null) {\r\n          o = o.right\r\n        }\r\n        // switch\r\n        d.val = o.val\r\n        d = o\r\n      }\r\n      // d has at most one child\r\n      // let n be the node that replaces d\r\n      var isFakeChild\r\n      var child = d.left || d.right\r\n      if (child === null) {\r\n        isFakeChild = true\r\n        child = new N({id: 0})\r\n        child.blacken()\r\n        d.right = child\r\n      } else {\r\n        isFakeChild = false\r\n      }\r\n\r\n      if (d.parent === null) {\r\n        if (!isFakeChild) {\r\n          this.root = child\r\n          child.blacken()\r\n          child._parent = null\r\n        } else {\r\n          this.root = null\r\n        }\r\n        return\r\n      } else if (d.parent.left === d) {\r\n        d.parent.left = child\r\n      } else if (d.parent.right === d) {\r\n        d.parent.right = child\r\n      } else {\r\n        throw new Error('Impossible!')\r\n      }\r\n      if (d.isBlack()) {\r\n        if (child.isRed()) {\r\n          child.blacken()\r\n        } else {\r\n          this._fixDelete(child)\r\n        }\r\n      }\r\n      this.root.blacken()\r\n      if (isFakeChild) {\r\n        if (child.parent.left === child) {\r\n          child.parent.left = null\r\n        } else if (child.parent.right === child) {\r\n          child.parent.right = null\r\n        } else {\r\n          throw new Error('Impossible #3')\r\n        }\r\n      }\r\n    }\r\n    _fixDelete (n) {\r\n      function isBlack (node) {\r\n        return node !== null ? node.isBlack() : true\r\n      }\r\n      function isRed (node) {\r\n        return node !== null ? node.isRed() : false\r\n      }\r\n      if (n.parent === null) {\r\n        // this can only be called after the first iteration of fixDelete.\r\n        return\r\n      }\r\n      // d was already replaced by the child\r\n      // d is not the root\r\n      // d and child are black\r\n      var sibling = n.sibling\r\n      if (isRed(sibling)) {\r\n        // make sibling the grandfather\r\n        n.parent.redden()\r\n        sibling.blacken()\r\n        if (n === n.parent.left) {\r\n          n.parent.rotateLeft(this)\r\n        } else if (n === n.parent.right) {\r\n          n.parent.rotateRight(this)\r\n        } else {\r\n          throw new Error('Impossible #2')\r\n        }\r\n        sibling = n.sibling\r\n      }\r\n      // parent, sibling, and children of n are black\r\n      if (n.parent.isBlack() &&\r\n        sibling.isBlack() &&\r\n        isBlack(sibling.left) &&\r\n        isBlack(sibling.right)\r\n      ) {\r\n        sibling.redden()\r\n        this._fixDelete(n.parent)\r\n      } else if (n.parent.isRed() &&\r\n        sibling.isBlack() &&\r\n        isBlack(sibling.left) &&\r\n        isBlack(sibling.right)\r\n      ) {\r\n        sibling.redden()\r\n        n.parent.blacken()\r\n      } else {\r\n        if (n === n.parent.left &&\r\n          sibling.isBlack() &&\r\n          isRed(sibling.left) &&\r\n          isBlack(sibling.right)\r\n        ) {\r\n          sibling.redden()\r\n          sibling.left.blacken()\r\n          sibling.rotateRight(this)\r\n          sibling = n.sibling\r\n        } else if (n === n.parent.right &&\r\n          sibling.isBlack() &&\r\n          isRed(sibling.right) &&\r\n          isBlack(sibling.left)\r\n        ) {\r\n          sibling.redden()\r\n          sibling.right.blacken()\r\n          sibling.rotateLeft(this)\r\n          sibling = n.sibling\r\n        }\r\n        sibling.color = n.parent.color\r\n        n.parent.blacken()\r\n        if (n === n.parent.left) {\r\n          sibling.right.blacken()\r\n          n.parent.rotateLeft(this)\r\n        } else {\r\n          sibling.left.blacken()\r\n          n.parent.rotateRight(this)\r\n        }\r\n      }\r\n    }\r\n    * put (v) {\r\n      if (v == null || v.id == null || v.id.constructor !== Array) {\r\n        throw new Error('v is expected to have an id property which is an Array!')\r\n      }\r\n      var node = new N(v)\r\n      if (this.root !== null) {\r\n        var p = this.root // p abbrev. parent\r\n        while (true) {\r\n          if (Y.utils.smaller(node.val.id, p.val.id)) {\r\n            if (p.left === null) {\r\n              p.left = node\r\n              break\r\n            } else {\r\n              p = p.left\r\n            }\r\n          } else if (Y.utils.smaller(p.val.id, node.val.id)) {\r\n            if (p.right === null) {\r\n              p.right = node\r\n              break\r\n            } else {\r\n              p = p.right\r\n            }\r\n          } else {\r\n            p.val = node.val\r\n            return p\r\n          }\r\n        }\r\n        this._fixInsert(node)\r\n      } else {\r\n        this.root = node\r\n      }\r\n      this.length++\r\n      this.root.blacken()\r\n      return node\r\n    }\r\n    _fixInsert (n) {\r\n      if (n.parent === null) {\r\n        n.blacken()\r\n        return\r\n      } else if (n.parent.isBlack()) {\r\n        return\r\n      }\r\n      var uncle = n.getUncle()\r\n      if (uncle !== null && uncle.isRed()) {\r\n        // Note: parent: red, uncle: red\r\n        n.parent.blacken()\r\n        uncle.blacken()\r\n        n.grandparent.redden()\r\n        this._fixInsert(n.grandparent)\r\n      } else {\r\n        // Note: parent: red, uncle: black or null\r\n        // Now we transform the tree in such a way that\r\n        // either of these holds:\r\n        //   1) grandparent.left.isRed\r\n        //     and grandparent.left.left.isRed\r\n        //   2) grandparent.right.isRed\r\n        //     and grandparent.right.right.isRed\r\n        if (n === n.parent.right && n.parent === n.grandparent.left) {\r\n          n.parent.rotateLeft(this)\r\n          // Since we rotated and want to use the previous\r\n          // cases, we need to set n in such a way that\r\n          // n.parent.isRed again\r\n          n = n.left\r\n        } else if (n === n.parent.left && n.parent === n.grandparent.right) {\r\n          n.parent.rotateRight(this)\r\n          // see above\r\n          n = n.right\r\n        }\r\n        // Case 1) or 2) hold from here on.\r\n        // Now traverse grandparent, make parent a black node\r\n        // on the highest level which holds two red nodes.\r\n        n.parent.blacken()\r\n        n.grandparent.redden()\r\n        if (n === n.parent.left) {\r\n          // Case 1\r\n          n.grandparent.rotateRight(this)\r\n        } else {\r\n          // Case 2\r\n          n.grandparent.rotateLeft(this)\r\n        }\r\n      }\r\n    }\r\n    * flush () {}\r\n  }\r\n\r\n  Y.utils.RBTree = RBTree\r\n}\r\n"],"sourceRoot":"/source/"}