!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){e.requestModules(["Array","Map"]).then(function(){var t=function(t){function n(t,i,a,s,c,l){r(this,n);var d=o(this,Object.getPrototypeOf(n).call(this,t,i,a));return d.attributes=s,d.dom=null,d._domObserver=null,d._eventListenerHandler=new e.utils.EventListenerHandler,d.tagname=c,null!=l&&null!=l.dom&&d._setDom(l.dom),u(Object.getPrototypeOf(n.prototype),"observe",d).call(d,function(e){var t=[];e.forEach(function(e){"insert"===e.type?t.push({type:"childInserted",index:e.index,node:e.value,valueId:e.valueId}):"delete"===e.type&&t.push({type:"childRemoved",index:e.index,_content:e._content,value:e.value})}),t.length>0&&d._eventListenerHandler.callEventListeners(t)}),s.observe(function(e){var t=[];e.forEach(function(e){"update"===e.type||"add"===e.type?t.push({type:"attributeChanged",name:e.name,value:e.value}):"delete"===e.type&&t.push({type:"attributeRemoved",name:e.name})}),t.length>0&&d._eventListenerHandler.callEventListeners(t)}),d}return i(n,t),s(n,[{key:"_destroy",value:function(){null!=this._domObserver&&this._domObserver.disconnect(),this._eventListenerHandler.destroy(),this._eventListenerHandler=null,u(Object.getPrototypeOf(n.prototype),"_destroy",this).call(this)}},{key:"insert",value:function(t,r){if(!Array.isArray(r))throw new Error("Expected an Array of content!");r.forEach(function(t){var r=e.utils.isTypeDefinition(t);if(!t||!("string"==typeof t||r&&r[0]["class"]===n))throw new Error("Expected Y.Xml type or String!")}),u(Object.getPrototypeOf(n.prototype),"insert",this).call(this,t,r)}},{key:"_bindToDom",value:function(t){var n=this;return new Promise(function(r){var o=!0,i=function(e){var t=n._domObserver.takeRecords();if(t.length>0&&n._domObserverListener(t),o){o=!1;try{e()}catch(r){throw n._domObserver.takeRecords(),o=!0,r}n._domObserver.takeRecords(),o=!0}};n._mutualExclude=i,n._domObserverListener=function(t){i(function(){t.forEach(function(t){"attributes"===t.type?n.attributes.set(t.attributeName,t.target.getAttribute(t.attributeName)):"childList"===t.type&&(Array.prototype.forEach.call(Array.prototype.reverse.call(t.addedNodes),function(t){var r;r=null==t.nextSibling?n._content.length:n._content.findIndex(function(e){return e.dom===t.nextSibling});var o;if(t instanceof window.Text)o=t.textContent;else{if(!(t instanceof window.Element))throw new Error("Unsupported XML Element found. Synchronization will no longer work!");o=e.Xml(t)}n.insert(r,[o]);var i=n._content[r];i.dom=t,i.isInserted=!0,a(r-1)}),Array.prototype.forEach.call(t.removedNodes,function(e){var t=n._content.findIndex(function(t){return t.dom===e});n["delete"](t)}))})})},n._domObserver=new MutationObserver(n._domObserverListener),n._domObserver.observe(t,{attributes:!0,childList:!0});var a=function(e){var r,o=n._content[e];for(r=e+1<n._content.length?n._content[e+1]:{isInserted:!0,dom:null};e>=0&&r.isInserted&&null!=o.dom&&!o.isInserted;)t.insertBefore(o.dom,r.dom),o.isInserted=!0,r=o,o=n._content[--e]};n._tryInsertDom=a,n.observe(function(e){i(function(){e.sort(function(e,t){return e.index<t.index}).forEach(function(e){if("attributeChanged"===e.type)t.setAttribute(e.name,e.value);else if("attributeRemoved"===e.type)t.removeAttribute(e.name);else if("childInserted"===e.type)if("string"==typeof e.node){var r=new window.Text(e.node);n._content[e.index].dom=r,a(e.index)}else e.node().then(function(e){return e.getDom()}).then(function(t){i(function(){var r=n._content.findIndex(function(t){return t.id===e.valueId});r>=0&&(n._content[r].dom=t,a(r))})});else if("childRemoved"===e.type){var o=e._content.dom;null!=o&&o.remove(),a(e.index-1)}})})}),r(t)})}},{key:"_setDom",value:function(t){var n=this;if(null!=this.dom)throw new Error("Only call this method if you know what you are doing ;)");if(null!=t.__yxml)throw new Error("Already bound to an YXml type");t.__yxml=this._model;for(var r=0;r<t.attributes.length;r++){var o=t.attributes[r];this.attributes.set(o.name,o.value)}return this.insert(0,Array.prototype.map.call(t.childNodes,function(t,n){if(t instanceof window.Element)return e.Xml(t);if(t instanceof window.Text)return t.textContent;throw new Error("Unknown node type!")})),Array.prototype.forEach.call(t.childNodes,function(e,t){var r=n._content[t];r.dom=e,r.isInserted=!0}),this.dom=this._bindToDom(t),this.dom}},{key:"getDom",value:function(){var e=this;if(null==this.dom){var t=document.createElement(this.tagname);return t.__yxml=this,this.attributes.keysPrimitives().forEach(function(n){t.setAttribute(n,e.attributes.get(n))}),new Promise(function(n){var r=e;e.os.requestTransaction(regeneratorRuntime.mark(function o(){var e,i,a,s,u=this;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:e=[],i=regeneratorRuntime.mark(function c(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=r._content[a],!t.hasOwnProperty("val")){n.next=5;break}e.push([new window.Text(t.val),t]),n.next=8;break;case 5:return n.delegateYield(u.getType(t.type),"t0",6);case 6:s=n.t0,e.push(s.getDom().then(function(e){return[e,t]}));case 8:case"end":return n.stop()}},c,u)}),a=0;case 3:if(!(a<r._content.length)){o.next=8;break}return o.delegateYield(i(),"t0",5);case 5:a++,o.next=3;break;case 8:r.dom=r._bindToDom(t),Promise.all(e).then(function(e){r._mutualExclude(function(){e.forEach(function(e,t){var n;n=r._content[t]===e[1]?t:r._content.findIndex(function(t){return t===e[1]}),n>=0&&(e[1].dom=e[0],r._tryInsertDom(n))}),r.dom.then(n)})});case 10:case"end":return o.stop()}},o,this)}))})}return this.dom}},{key:"observe",value:function(e){this._eventListenerHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this._eventListenerHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function a(){var t=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),n.delegateYield(e.Array.typeDefinition["class"].prototype._changed.apply(this,t),"t0",2);case 2:case"end":return n.stop()}},a,this)})}]),n}(e.Array.typeDefinition["class"]);e.extend("Xml",new e.utils.CustomType({name:"Xml","class":t,struct:"List",parseArguments:function(e){if("string"==typeof e)return[this,{tagname:e}];if(e instanceof window.Element)return[this,{tagname:e.tagName,dom:e}];throw new Error("Y.Xml requires an argument which is a string!")},appendAdditionalInfo:regeneratorRuntime.mark(function n(t,r){var o,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=null,"_"===t.id[0]&&(i=e.Map.typeDefinition.struct,o=["_",i+"_Map_"+t.id[1]]),n.delegateYield(this.createType(e.Map(),o),"t0",3);case 3:a=n.t0,t.info={tagname:r.tagname},t.requires=[a._model];case 6:case"end":return n.stop()}},n,this)}),initType:regeneratorRuntime.mark(function a(n,r,o){var i,s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.delegateYield(e.Struct.List.map.call(this,r,function(e){var t={id:JSON.stringify(e.id)};return e.hasOwnProperty("opContent")?t.type=e.opContent:t.val=e.content,t}),"t0",1);case 1:return i=a.t0,a.delegateYield(this.getType(r.requires[0]),"t1",3);case 3:return s=a.t1,a.abrupt("return",new t(n,r.id,i,s,r.info.tagname,o));case 5:case"end":return a.stop()}},a,this)})}))})}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function c(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:c(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};t.exports=a,"undefined"!=typeof Y&&a(Y)},{}]},{},[1]);
//# sourceMappingURL=y-xml.js.map