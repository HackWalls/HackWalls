!function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t=function(){function t(n,i,a){var o=this;r(this,t),this.os=n,this._model=i,this._content=a,this.eventHandler=new e.utils.EventHandler(function(e){var t=[];e.forEach(function(e){if("Insert"===e.struct){var n=void 0;null===e.left?n=0:!function(){var t=JSON.stringify(e.left);if(n=1+o._content.findIndex(function(e){return e.id===t}),0>=n)throw new Error("Unexpected operation!")}();var r,i=JSON.stringify(e.id);e.hasOwnProperty("opContent")?!function(){o._content.splice(n,0,{id:i,type:e.opContent});var t=e.opContent;r=function(){return new Promise(function(e){o.os.requestTransaction(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(this.getType(t),"t0",1);case 1:r=n.t0,e(r);case 3:case"end":return n.stop()}},n,this)}))})}}():(o._content.splice(n,0,{id:i,val:e.content}),r=e.content),t.push({type:"insert",object:o,index:n,value:r,valueId:i,length:1})}else{if("Delete"!==e.struct)throw new Error("Unexpected struct!");!function(){var n=JSON.stringify(e.target),r=o._content.findIndex(function(e){return e.id===n});r>=0&&!function(){var e=o._content[r];o._content.splice(r,1);var n=void 0;n=e.hasOwnProperty("val")?e.val:function(){return new Promise(function(t){o.os.requestTransaction(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(this.getType(e.type),"t0",1);case 1:r=n.t0,t(r);case 3:case"end":return n.stop()}},n,this)}))})},t.push({type:"delete",object:o,index:r,value:n,_content:e,length:1})}()}()}}),o.eventHandler.callEventListeners(t)})}return a(t,[{key:"_destroy",value:function(){this.eventHandler.destroy(),this.eventHandler=null,this._content=null,this._model=null,this.os=null}},{key:"get",value:function(e){var t=this;if(null==e||"number"!=typeof e)throw new Error("pos must be a number!");if(!(e>=this._content.length)){if(null==this._content[e].type)return this._content[e].val;var n=this._content[e].type;return new Promise(function(e){t.os.requestTransaction(regeneratorRuntime.mark(function r(){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(this.getType(n),"t0",1);case 1:t=r.t0,e(t);case 3:case"end":return r.stop()}},r,this)}))})}}},{key:"toArray",value:function(){return this._content.map(function(e,t){return e.val})}},{key:"push",value:function(e){this.insert(this._content.length,e)}},{key:"insert",value:function(t,n){if("number"!=typeof t)throw new Error("pos must be a number!");if(!(n instanceof Array))throw new Error("contents must be an Array of objects!");if(0!==n.length){if(t>this._content.length||0>t)throw new Error("This position exceeds the range of the array!");for(var r=0===t?null:JSON.parse(this._content[t-1].id),i=[],a=[],o=r,s=0;s<n.length;s++){var u={left:o,origin:o,parent:this._model,struct:"Insert",id:this.os.getNextOpId()},c=n[s],l=e.utils.isTypeDefinition(c);if(l){var f=this.os.getNextOpId();a.push([l,f]),u.opContent=f}else u.content=c;i.push(u),o=u.id}var h=this.eventHandler;this.os.requestTransaction(regeneratorRuntime.mark(function p(){var e,t,n,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(null==r){s.next=5;break}return s.delegateYield(this.getOperation(r),"t0",2);case 2:e=s.t0.right,s.next=7;break;case 5:return s.delegateYield(this.getOperation(i[0].parent),"t1",6);case 6:e=s.t1.start;case 7:t=0;case 8:if(!(t<a.length)){s.next=13;break}return s.delegateYield(this.createType.apply(this,a[t]),"t2",10);case 10:t++,s.next=8;break;case 13:for(n=0;n<i.length;n++)o=i[n],o.right=e;return s.delegateYield(this.applyCreatedOperations(i),"t3",15);case 15:h.awaitedInserts(i.length);case 16:case"end":return s.stop()}},p,this)})),h.awaitAndPrematurelyCall(i)}}},{key:"delete",value:function(e,t){if(null==t&&(t=1),"number"!=typeof t)throw new Error("length must be a number!");if("number"!=typeof e)throw new Error("pos must be a number!");if(e+t>this._content.length||0>e||0>t)throw new Error("The deletion range exceeds the range of the array!");if(0!==t){for(var n=this.eventHandler,r=e>0?JSON.parse(this._content[e-1].id):null,i=[],a=0;t>a;a++)i.push({target:JSON.parse(this._content[e+a].id),struct:"Delete"});n.awaitAndPrematurelyCall(i),this.os.requestTransaction(regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.applyCreatedOperations(i),"t0",1);case 1:n.awaitedDeletes(i.length,r);case 2:case"end":return e.stop()}},o,this)}))}}},{key:"observe",value:function(e){this.eventHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this.eventHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function n(e,t){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.deleted){n.next=13;break}if("Insert"!==t.struct){n.next=12;break}r=t.left;case 3:if(null==r){n.next=11;break}return n.delegateYield(e.getOperation(r),"t0",5);case 5:if(i=n.t0,i.deleted){n.next=8;break}return n.abrupt("break",11);case 8:r=i.left,n.next=3;break;case 11:t.left=r;case 12:this.eventHandler.receivedOp(t);case 13:case"end":return n.stop()}},n,this)})},{key:"length",get:function(){return this._content.length}}]),t}();e.extend("Array",new e.utils.CustomType({name:"Array","class":t,struct:"List",initType:regeneratorRuntime.mark(function n(r,i){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(e.Struct.List.map.call(this,i,function(e){var t={id:JSON.stringify(e.id)};return e.hasOwnProperty("opContent")?t.type=e.opContent:t.val=e.content,t}),"t0",1);case 1:return a=n.t0,n.abrupt("return",new t(r,i.id,a));case 3:case"end":return n.stop()}},n,this)})}))}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=i,"undefined"!=typeof Y&&i(Y)},{}]},{},[1]);
//# sourceMappingURL=y-array.js.map