{"version":3,"sources":["../yjs/node_modules/browserify/node_modules/browser-pack/_prelude.js","src/Array.js","y-array.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","_classCallCheck","instance","Constructor","TypeError","extend","Y","YArray","os","_model","_content","_this","this","eventHandler","utils","EventHandler","ops","userEvents","forEach","op","struct","pos","undefined","left","sid","JSON","stringify","findIndex","c","id","value","valueId","hasOwnProperty","splice","type","opContent","Promise","resolve","requestTransaction","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","delegateYield","getType","t0","stop","val","content","push","object","index","target","_callee2","_context2","callEventListeners","_createClass","key","destroy","_this2","oid","_callee3","_context3","map","x","contents","insert","Array","mostLeft","parse","newTypes","prevId","origin","parent","getNextOpId","typeDefinition","isTypeDefinition","typeid","_callee4","mostRight","j","_context4","getOperation","right","t1","start","createType","apply","applyCreatedOperations","awaitedInserts","awaitAndPrematurelyCall","newLeft","dels","_callee5","_context5","awaitedDeletes","addEventListener","removeEventListener","_changed","transaction","_context6","deleted","abrupt","receivedOp","get","CustomType","name","class","initType","YArrayInitializer","model","_context7","Struct","List","defineProperties","props","descriptor","enumerable","configurable","writable","Object","defineProperty","protoProps","staticProps","prototype"],"mappings":"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","file":"y-array.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\n'use strict'\n\nfunction extend (Y) {\n  class YArray {\n    constructor (os, _model, _content) {\n      this.os = os\n      this._model = _model\n      // Array of all the neccessary content (includes id (string formatted, and element value))\n      this._content = _content\n      this.eventHandler = new Y.utils.EventHandler(ops => {\n        var userEvents = []\n        ops.forEach(op => {\n          if (op.struct === 'Insert') {\n            let pos\n            // we check op.left only!,\n            // because op.right might not be defined when this is called\n            if (op.left === null) {\n              pos = 0\n            } else {\n              let sid = JSON.stringify(op.left)\n              pos = 1 + this._content.findIndex(function (c) {\n                return c.id === sid\n              })\n              if (pos <= 0) {\n                throw new Error('Unexpected operation!')\n              }\n            }\n            var value\n            var valueId = JSON.stringify(op.id)\n            if (op.hasOwnProperty('opContent')) {\n              this._content.splice(pos, 0, {\n                id: valueId,\n                type: op.opContent\n              })\n              let opContent = op.opContent\n              value = () => {\n                return new Promise(resolve => {\n                  this.os.requestTransaction(function *() {\n                    var type = yield* this.getType(opContent)\n                    resolve(type)\n                  })\n                })\n              }\n            } else {\n              this._content.splice(pos, 0, {\n                id: valueId,\n                val: op.content\n              })\n              value = op.content\n            }\n            userEvents.push({\n              type: 'insert',\n              object: this,\n              index: pos,\n              value: value,\n              valueId: valueId,\n              length: 1\n            })\n          } else if (op.struct === 'Delete') {\n            let sid = JSON.stringify(op.target)\n            let pos = this._content.findIndex(function (c) {\n              return c.id === sid\n            })\n            if (pos >= 0) {\n              let content = this._content[pos]\n              this._content.splice(pos, 1)\n              let value\n              if (content.hasOwnProperty('val')) {\n                value = content.val\n              } else {\n                value = () => {\n                  return new Promise(resolve => {\n                    this.os.requestTransaction(function *() {\n                      var type = yield* this.getType(content.type)\n                      resolve(type)\n                    })\n                  })\n                }\n              }\n              userEvents.push({\n                type: 'delete',\n                object: this,\n                index: pos,\n                value: value,\n                _content: content,\n                length: 1\n              })\n            }\n          } else {\n            throw new Error('Unexpected struct!')\n          }\n        })\n        this.eventHandler.callEventListeners(userEvents)\n      })\n    }\n    _destroy () {\n      this.eventHandler.destroy()\n      this.eventHandler = null\n      this._content = null\n      this._model = null\n      this.os = null\n    }\n    get length () {\n      return this._content.length\n    }\n    get (pos) {\n      if (pos == null || typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos >= this._content.length) {\n        return undefined\n      }\n      if (this._content[pos].type == null) {\n        return this._content[pos].val\n      } else {\n        var oid = this._content[pos].type\n        return new Promise((resolve) => {\n          this.os.requestTransaction(function *() {\n            var type = yield* this.getType(oid)\n            resolve(type)\n          })\n        })\n      }\n    }\n    // only returns primitive values\n    toArray () {\n      return this._content.map(function (x, i) {\n        return x.val\n      })\n    }\n    push (contents) {\n      this.insert(this._content.length, contents)\n    }\n    insert (pos, contents) {\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (!(contents instanceof Array)) {\n        throw new Error('contents must be an Array of objects!')\n      }\n      if (contents.length === 0) {\n        return\n      }\n      if (pos > this._content.length || pos < 0) {\n        throw new Error('This position exceeds the range of the array!')\n      }\n      var mostLeft = pos === 0 ? null : JSON.parse(this._content[pos - 1].id)\n\n      var ops = []\n      var newTypes = []\n      var prevId = mostLeft\n      for (var i = 0; i < contents.length; i++) {\n        var op = {\n          left: prevId,\n          origin: prevId,\n          // right: mostRight,\n          // NOTE: I intentionally do not define right here, because it could be deleted\n          // at the time of inserting this operation (when we get the transaction),\n          // and would therefore not defined in this._content\n          parent: this._model,\n          struct: 'Insert',\n          id: this.os.getNextOpId()\n        }\n        var val = contents[i]\n        var typeDefinition = Y.utils.isTypeDefinition(val)\n        if (!typeDefinition) {\n          op.content = val\n        } else {\n          var typeid = this.os.getNextOpId()\n          newTypes.push([typeDefinition, typeid])\n          op.opContent = typeid\n        }\n        ops.push(op)\n        prevId = op.id\n      }\n      var eventHandler = this.eventHandler\n      this.os.requestTransaction(function *() {\n        // now we can set the right reference.\n        var mostRight\n        if (mostLeft != null) {\n          mostRight = (yield* this.getOperation(mostLeft)).right\n        } else {\n          mostRight = (yield* this.getOperation(ops[0].parent)).start\n        }\n        for (var i = 0; i < newTypes.length; i++) {\n          yield* this.createType.apply(this, newTypes[i])\n        }\n        for (var j = 0; j < ops.length; j++) {\n          var op = ops[j]\n          op.right = mostRight\n        }\n        yield* this.applyCreatedOperations(ops)\n        eventHandler.awaitedInserts(ops.length)\n      })\n      eventHandler.awaitAndPrematurelyCall(ops)\n    }\n    delete (pos, length) {\n      if (length == null) { length = 1 }\n      if (typeof length !== 'number') {\n        throw new Error('length must be a number!')\n      }\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos + length > this._content.length || pos < 0 || length < 0) {\n        throw new Error('The deletion range exceeds the range of the array!')\n      }\n      if (length === 0) {\n        return\n      }\n      var eventHandler = this.eventHandler\n      var newLeft = pos > 0 ? JSON.parse(this._content[pos - 1].id) : null\n      var dels = []\n      for (var i = 0; i < length; i++) {\n        dels.push({\n          target: JSON.parse(this._content[pos + i].id),\n          struct: 'Delete'\n        })\n      }\n      eventHandler.awaitAndPrematurelyCall(dels)\n      this.os.requestTransaction(function *() {\n        yield* this.applyCreatedOperations(dels)\n        eventHandler.awaitedDeletes(dels.length, newLeft)\n      })\n    }\n    observe (f) {\n      this.eventHandler.addEventListener(f)\n    }\n    unobserve (f) {\n      this.eventHandler.removeEventListener(f)\n    }\n    * _changed (transaction, op) {\n      if (!op.deleted) {\n        if (op.struct === 'Insert') {\n          var l = op.left\n          var left\n          while (l != null) {\n            left = yield* transaction.getOperation(l)\n            if (!left.deleted) {\n              break\n            }\n            l = left.left\n          }\n          op.left = l\n        }\n        this.eventHandler.receivedOp(op)\n      }\n    }\n  }\n\n  Y.extend('Array', new Y.utils.CustomType({\n    name: 'Array',\n    class: YArray,\n    struct: 'List',\n    initType: function * YArrayInitializer (os, model) {\n      var _content = yield* Y.Struct.List.map.call(this, model, function (op) {\n        var c = {\n          id: JSON.stringify(op.id)\n        }\n        if (op.hasOwnProperty('opContent')) {\n          c.type = op.opContent\n        } else {\n          c.val = op.content\n        }\n        return c\n      })\n      return new YArray(os, model.id, _content)\n    }\n  }))\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/* global Y */\n'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction extend(Y) {\n  var YArray = (function () {\n    function YArray(os, _model, _content) {\n      var _this = this;\n\n      _classCallCheck(this, YArray);\n\n      this.os = os;\n      this._model = _model;\n      // Array of all the neccessary content (includes id (string formatted, and element value))\n      this._content = _content;\n      this.eventHandler = new Y.utils.EventHandler(function (ops) {\n        var userEvents = [];\n        ops.forEach(function (op) {\n          if (op.struct === 'Insert') {\n            var pos = undefined;\n            // we check op.left only!,\n            // because op.right might not be defined when this is called\n            if (op.left === null) {\n              pos = 0;\n            } else {\n              (function () {\n                var sid = JSON.stringify(op.left);\n                pos = 1 + _this._content.findIndex(function (c) {\n                  return c.id === sid;\n                });\n                if (pos <= 0) {\n                  throw new Error('Unexpected operation!');\n                }\n              })();\n            }\n            var value;\n            var valueId = JSON.stringify(op.id);\n            if (op.hasOwnProperty('opContent')) {\n              (function () {\n                _this._content.splice(pos, 0, {\n                  id: valueId,\n                  type: op.opContent\n                });\n                var opContent = op.opContent;\n                value = function () {\n                  return new Promise(function (resolve) {\n                    _this.os.requestTransaction(regeneratorRuntime.mark(function _callee() {\n                      var type;\n                      return regeneratorRuntime.wrap(function _callee$(_context) {\n                        while (1) {\n                          switch (_context.prev = _context.next) {\n                            case 0:\n                              return _context.delegateYield(this.getType(opContent), 't0', 1);\n\n                            case 1:\n                              type = _context.t0;\n\n                              resolve(type);\n\n                            case 3:\n                            case 'end':\n                              return _context.stop();\n                          }\n                        }\n                      }, _callee, this);\n                    }));\n                  });\n                };\n              })();\n            } else {\n              _this._content.splice(pos, 0, {\n                id: valueId,\n                val: op.content\n              });\n              value = op.content;\n            }\n            userEvents.push({\n              type: 'insert',\n              object: _this,\n              index: pos,\n              value: value,\n              valueId: valueId,\n              length: 1\n            });\n          } else if (op.struct === 'Delete') {\n            (function () {\n              var sid = JSON.stringify(op.target);\n              var pos = _this._content.findIndex(function (c) {\n                return c.id === sid;\n              });\n              if (pos >= 0) {\n                (function () {\n                  var content = _this._content[pos];\n                  _this._content.splice(pos, 1);\n                  var value = undefined;\n                  if (content.hasOwnProperty('val')) {\n                    value = content.val;\n                  } else {\n                    value = function () {\n                      return new Promise(function (resolve) {\n                        _this.os.requestTransaction(regeneratorRuntime.mark(function _callee2() {\n                          var type;\n                          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                            while (1) {\n                              switch (_context2.prev = _context2.next) {\n                                case 0:\n                                  return _context2.delegateYield(this.getType(content.type), 't0', 1);\n\n                                case 1:\n                                  type = _context2.t0;\n\n                                  resolve(type);\n\n                                case 3:\n                                case 'end':\n                                  return _context2.stop();\n                              }\n                            }\n                          }, _callee2, this);\n                        }));\n                      });\n                    };\n                  }\n                  userEvents.push({\n                    type: 'delete',\n                    object: _this,\n                    index: pos,\n                    value: value,\n                    _content: content,\n                    length: 1\n                  });\n                })();\n              }\n            })();\n          } else {\n            throw new Error('Unexpected struct!');\n          }\n        });\n        _this.eventHandler.callEventListeners(userEvents);\n      });\n    }\n\n    _createClass(YArray, [{\n      key: '_destroy',\n      value: function _destroy() {\n        this.eventHandler.destroy();\n        this.eventHandler = null;\n        this._content = null;\n        this._model = null;\n        this.os = null;\n      }\n    }, {\n      key: 'get',\n      value: function get(pos) {\n        var _this2 = this;\n\n        if (pos == null || typeof pos !== 'number') {\n          throw new Error('pos must be a number!');\n        }\n        if (pos >= this._content.length) {\n          return undefined;\n        }\n        if (this._content[pos].type == null) {\n          return this._content[pos].val;\n        } else {\n          var oid = this._content[pos].type;\n          return new Promise(function (resolve) {\n            _this2.os.requestTransaction(regeneratorRuntime.mark(function _callee3() {\n              var type;\n              return regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      return _context3.delegateYield(this.getType(oid), 't0', 1);\n\n                    case 1:\n                      type = _context3.t0;\n\n                      resolve(type);\n\n                    case 3:\n                    case 'end':\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3, this);\n            }));\n          });\n        }\n      }\n      // only returns primitive values\n\n    }, {\n      key: 'toArray',\n      value: function toArray() {\n        return this._content.map(function (x, i) {\n          return x.val;\n        });\n      }\n    }, {\n      key: 'push',\n      value: function push(contents) {\n        this.insert(this._content.length, contents);\n      }\n    }, {\n      key: 'insert',\n      value: function insert(pos, contents) {\n        if (typeof pos !== 'number') {\n          throw new Error('pos must be a number!');\n        }\n        if (!(contents instanceof Array)) {\n          throw new Error('contents must be an Array of objects!');\n        }\n        if (contents.length === 0) {\n          return;\n        }\n        if (pos > this._content.length || pos < 0) {\n          throw new Error('This position exceeds the range of the array!');\n        }\n        var mostLeft = pos === 0 ? null : JSON.parse(this._content[pos - 1].id);\n\n        var ops = [];\n        var newTypes = [];\n        var prevId = mostLeft;\n        for (var i = 0; i < contents.length; i++) {\n          var op = {\n            left: prevId,\n            origin: prevId,\n            // right: mostRight,\n            // NOTE: I intentionally do not define right here, because it could be deleted\n            // at the time of inserting this operation (when we get the transaction),\n            // and would therefore not defined in this._content\n            parent: this._model,\n            struct: 'Insert',\n            id: this.os.getNextOpId()\n          };\n          var val = contents[i];\n          var typeDefinition = Y.utils.isTypeDefinition(val);\n          if (!typeDefinition) {\n            op.content = val;\n          } else {\n            var typeid = this.os.getNextOpId();\n            newTypes.push([typeDefinition, typeid]);\n            op.opContent = typeid;\n          }\n          ops.push(op);\n          prevId = op.id;\n        }\n        var eventHandler = this.eventHandler;\n        this.os.requestTransaction(regeneratorRuntime.mark(function _callee4() {\n          var mostRight, i, j, op;\n          return regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  if (!(mostLeft != null)) {\n                    _context4.next = 5;\n                    break;\n                  }\n\n                  return _context4.delegateYield(this.getOperation(mostLeft), 't0', 2);\n\n                case 2:\n                  mostRight = _context4.t0.right;\n                  _context4.next = 7;\n                  break;\n\n                case 5:\n                  return _context4.delegateYield(this.getOperation(ops[0].parent), 't1', 6);\n\n                case 6:\n                  mostRight = _context4.t1.start;\n\n                case 7:\n                  i = 0;\n\n                case 8:\n                  if (!(i < newTypes.length)) {\n                    _context4.next = 13;\n                    break;\n                  }\n\n                  return _context4.delegateYield(this.createType.apply(this, newTypes[i]), 't2', 10);\n\n                case 10:\n                  i++;\n                  _context4.next = 8;\n                  break;\n\n                case 13:\n                  for (j = 0; j < ops.length; j++) {\n                    op = ops[j];\n\n                    op.right = mostRight;\n                  }\n                  return _context4.delegateYield(this.applyCreatedOperations(ops), 't3', 15);\n\n                case 15:\n                  eventHandler.awaitedInserts(ops.length);\n\n                case 16:\n                case 'end':\n                  return _context4.stop();\n              }\n            }\n          }, _callee4, this);\n        }));\n        eventHandler.awaitAndPrematurelyCall(ops);\n      }\n    }, {\n      key: 'delete',\n      value: function _delete(pos, length) {\n        if (length == null) {\n          length = 1;\n        }\n        if (typeof length !== 'number') {\n          throw new Error('length must be a number!');\n        }\n        if (typeof pos !== 'number') {\n          throw new Error('pos must be a number!');\n        }\n        if (pos + length > this._content.length || pos < 0 || length < 0) {\n          throw new Error('The deletion range exceeds the range of the array!');\n        }\n        if (length === 0) {\n          return;\n        }\n        var eventHandler = this.eventHandler;\n        var newLeft = pos > 0 ? JSON.parse(this._content[pos - 1].id) : null;\n        var dels = [];\n        for (var i = 0; i < length; i++) {\n          dels.push({\n            target: JSON.parse(this._content[pos + i].id),\n            struct: 'Delete'\n          });\n        }\n        eventHandler.awaitAndPrematurelyCall(dels);\n        this.os.requestTransaction(regeneratorRuntime.mark(function _callee5() {\n          return regeneratorRuntime.wrap(function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  return _context5.delegateYield(this.applyCreatedOperations(dels), 't0', 1);\n\n                case 1:\n                  eventHandler.awaitedDeletes(dels.length, newLeft);\n\n                case 2:\n                case 'end':\n                  return _context5.stop();\n              }\n            }\n          }, _callee5, this);\n        }));\n      }\n    }, {\n      key: 'observe',\n      value: function observe(f) {\n        this.eventHandler.addEventListener(f);\n      }\n    }, {\n      key: 'unobserve',\n      value: function unobserve(f) {\n        this.eventHandler.removeEventListener(f);\n      }\n    }, {\n      key: '_changed',\n      value: regeneratorRuntime.mark(function _changed(transaction, op) {\n        var l, left;\n        return regeneratorRuntime.wrap(function _changed$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (op.deleted) {\n                  _context6.next = 13;\n                  break;\n                }\n\n                if (!(op.struct === 'Insert')) {\n                  _context6.next = 12;\n                  break;\n                }\n\n                l = op.left;\n\n              case 3:\n                if (!(l != null)) {\n                  _context6.next = 11;\n                  break;\n                }\n\n                return _context6.delegateYield(transaction.getOperation(l), 't0', 5);\n\n              case 5:\n                left = _context6.t0;\n\n                if (left.deleted) {\n                  _context6.next = 8;\n                  break;\n                }\n\n                return _context6.abrupt('break', 11);\n\n              case 8:\n                l = left.left;\n                _context6.next = 3;\n                break;\n\n              case 11:\n                op.left = l;\n\n              case 12:\n                this.eventHandler.receivedOp(op);\n\n              case 13:\n              case 'end':\n                return _context6.stop();\n            }\n          }\n        }, _changed, this);\n      })\n    }, {\n      key: 'length',\n      get: function get() {\n        return this._content.length;\n      }\n    }]);\n\n    return YArray;\n  })();\n\n  Y.extend('Array', new Y.utils.CustomType({\n    name: 'Array',\n    class: YArray,\n    struct: 'List',\n    initType: regeneratorRuntime.mark(function YArrayInitializer(os, model) {\n      var _content;\n\n      return regeneratorRuntime.wrap(function YArrayInitializer$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              return _context7.delegateYield(Y.Struct.List.map.call(this, model, function (op) {\n                var c = {\n                  id: JSON.stringify(op.id)\n                };\n                if (op.hasOwnProperty('opContent')) {\n                  c.type = op.opContent;\n                } else {\n                  c.val = op.content;\n                }\n                return c;\n              }), 't0', 1);\n\n            case 1:\n              _content = _context7.t0;\n              return _context7.abrupt('return', new YArray(os, model.id, _content));\n\n            case 3:\n            case 'end':\n              return _context7.stop();\n          }\n        }\n      }, YArrayInitializer, this);\n    })\n  }));\n}\n\nmodule.exports = extend;\nif (typeof Y !== 'undefined') {\n  extend(Y);\n}\n\n},{}]},{},[1])\n\n"],"sourceRoot":"/source/"}